<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InvestNYSE Pro | Terminal Global</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- ApexCharts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        :root {
            --bg-dark: #0b0e11;
            --bg-panel: #151a21;
            --bg-hover: #1e232b;
            --text-primary: #e0e0e0;
            --text-secondary: #9ca3af;
            
            --up-green: #00c076;
            --down-red: #ff3b30;
            --accent-blue: #3b82f6;
            --accent-gold: #f59e0b;
            
            --border-color: #2d3748;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Utilities */
        .font-mono { font-family: 'JetBrains Mono', monospace; letter-spacing: -0.5px; }
        .text-green { color: var(--up-green) !important; }
        .text-red { color: var(--down-red) !important; }
        .bg-green-subtle { background: rgba(0, 192, 118, 0.15); color: var(--up-green); }
        .bg-red-subtle { background: rgba(255, 59, 48, 0.15); color: var(--down-red); }
        
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: #2d3748; border-radius: 3px; }

        /* Navbar */
        .navbar {
            background-color: rgba(11, 14, 17, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-color);
            padding: 0.6rem 0;
            z-index: 1000;
        }
        .navbar-brand { font-weight: 800; letter-spacing: -0.5px; color: #fff !important; }
        .navbar-brand span { color: var(--accent-blue); }
        .nav-link { color: var(--text-secondary) !important; font-size: 0.85rem; font-weight: 600; text-transform: uppercase; }
        .nav-link:hover, .nav-link.active { color: var(--accent-blue) !important; }

        /* Search */
        .search-container { position: relative; width: 280px; }
        .search-input { background-color: #1a202c; border: 1px solid var(--border-color); color: #fff; font-size: 0.85rem; }
        .search-input:focus { background-color: #1a202c; border-color: var(--accent-blue); color: #fff; box-shadow: none; }
        .autocomplete-list {
            position: absolute; top: 100%; left: 0; right: 0; background: var(--bg-panel); border: 1px solid var(--border-color);
            z-index: 9999; list-style: none; padding: 0; margin: 0; max-height: 300px; overflow-y: auto; display: none;
        }
        .autocomplete-list.active { display: block; }
        .autocomplete-item { padding: 10px 15px; cursor: pointer; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; }
        .autocomplete-item:hover { background: var(--bg-hover); }

        /* Ticker Tape */
        .ticker-wrap { position: fixed; top: 60px; width: 100%; background: var(--bg-panel); border-bottom: 1px solid var(--border-color); height: 32px; line-height: 32px; z-index: 999; overflow: hidden; }
        .ticker-move { display: inline-block; white-space: nowrap; padding-right: 50px; }
        .ticker-item { display: inline-block; padding: 0 1.5rem; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; border-right: 1px solid var(--border-color); }

        /* View Sections */
        .view-section { display: none; padding-top: 100px; min-height: 100vh; animation: fadeIn 0.4s ease; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Panels & Cards */
        .panel { background: var(--bg-panel); border: 1px solid var(--border-color); border-radius: 6px; padding: 1.25rem; margin-bottom: 1.25rem; position: relative; }
        .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; border-bottom: 1px solid var(--border-color); padding-bottom: 0.8rem; }
        .panel-title { font-size: 0.9rem; font-weight: 700; color: #fff; text-transform: uppercase; letter-spacing: 0.5px; margin: 0; }

        /* ================== HERO SECTION REWORK ================== */
        .hero-container {
            display: grid;
            grid-template-columns: 2.5fr 1fr; /* Main Story vs List */
            gap: 1rem;
            height: 500px;
            margin-bottom: 2rem;
        }

        .hero-main {
            position: relative;
            border-radius: 6px;
            overflow: hidden;
            background-size: cover;
            background-position: center;
            cursor: pointer;
            display: flex;
            align-items: flex-end;
        }
        .hero-main::before {
            content: ''; position: absolute; top:0; left:0; width:100%; height:100%;
            background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.4) 50%, rgba(0,0,0,0) 100%);
        }
        .hero-main-content { position: relative; z-index: 2; padding: 2.5rem; width: 100%; }
        
        .hero-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            height: 100%;
            overflow-y: auto;
        }
        
        .hero-thumb-item {
            display: flex;
            align-items: center;
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1; /* Distribute height evenly */
            min-height: 90px;
        }
        .hero-thumb-item:hover { background: var(--bg-hover); border-color: var(--accent-blue); }
        
        .thumb-img {
            width: 80px; height: 60px;
            border-radius: 4px;
            object-fit: cover;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        .thumb-content { flex-grow: 1; overflow: hidden; }
        .thumb-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 4px;
            line-height: 1.3;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
        }
        
        .thumb-ticker-badge {
            display: inline-flex;
            align-items: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 3px;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-color);
        }
        .thumb-ticker-badge .val { color: #fff; margin-right: 5px; font-weight: bold; }
        
        /* ================== ETF SECTION ================== */
        .etf-scroll-container {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding-bottom: 10px;
            margin-bottom: 1.5rem;
        }
        
        .etf-card {
            min-width: 220px;
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1rem;
            transition: transform 0.2s;
            cursor: pointer;
        }
        .etf-card:hover { transform: translateY(-3px); border-color: var(--text-secondary); }
        
        .etf-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .etf-symbol { font-weight: 800; font-size: 1.1rem; color: #fff; }
        .etf-name { font-size: 0.75rem; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; display: block;}
        .etf-price { font-family: 'JetBrains Mono', monospace; font-size: 1.2rem; font-weight: 700; color: #fff; }
        .etf-chart { height: 40px; width: 100%; margin-top: 8px; }

        /* General Tables */
        .table-movers th { font-size: 0.7rem; color: var(--text-secondary); border-bottom: 1px solid var(--border-color); font-weight: 600; text-transform: uppercase; }
        .table-movers td { font-size: 0.85rem; color: #fff; border-bottom: 1px solid var(--border-color); vertical-align: middle; padding: 8px; }
        .ticker-tag { font-size: 0.7rem; font-weight: 700; color: var(--accent-blue); background: rgba(59, 130, 246, 0.1); padding: 1px 6px; border-radius: 3px; cursor: pointer; }

        @media(max-width: 992px) { 
            .hero-container { grid-template-columns: 1fr; height: auto; } 
            .hero-main { height: 300px; margin-bottom: 1rem; }
            .hero-list { height: auto; max-height: 500px; }
        }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container-fluid px-4">
            <a class="navbar-brand" href="#" onclick="app.router('home')">INVEST<span>NYSE</span> PRO</a>
            <button class="navbar-toggler navbar-dark" type="button" data-bs-toggle="collapse" data-bs-target="#navContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navContent">
                <ul class="navbar-nav me-auto ms-3">
                    <li class="nav-item"><a class="nav-link active" onclick="app.router('home')" data-target="home">Terminal</a></li>
                    <li class="nav-item"><a class="nav-link" onclick="app.router('acoes'); app.loadStockDetails('NVDA');" data-target="acoes">Ações</a></li>
                    <li class="nav-item"><a class="nav-link" onclick="app.router('noticias')" data-target="noticias">Notícias</a></li>
                </ul>
                <div class="d-flex align-items-center gap-3">
                    <div class="search-container">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text bg-dark border-secondary text-secondary"><i class="fas fa-search"></i></span>
                            <input type="text" class="form-control search-input" id="global-search" placeholder="Ticker (Ex: AAPL, BTC)..." autocomplete="off">
                        </div>
                        <ul class="autocomplete-list" id="search-results"></ul>
                    </div>
                    <div class="text-secondary small d-flex align-items-center">
                        <i class="fas fa-circle text-success me-2" style="font-size: 8px;" id="status-dot"></i>
                        <span id="market-status" style="font-size: 0.75rem; font-weight: 600;">CONECTANDO</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Ticker Tape -->
    <div class="ticker-wrap">
        <div class="ticker-move" id="ticker-content"></div>
    </div>

    <!-- ================= PAGE: HOME ================= -->
    <section id="home" class="view-section active">
        <div class="container-fluid px-4">
            
            <!-- NEW HERO SECTION WITH 5 THUMBNAILS -->
            <div class="hero-container" id="hero-section">
                <!-- Populated by JS -->
                <div class="hero-main shine-loader"></div>
                <div class="hero-list shine-loader"></div>
            </div>

            <!-- NEW ETF SECTION -->
            <div class="mb-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="text-white fw-bold m-0"><i class="fas fa-layer-group me-2 text-accent-blue"></i>ETFs Globais em Destaque</h5>
                    <span class="badge bg-dark border border-secondary text-secondary">Dados Simulados</span>
                </div>
                <div class="etf-scroll-container" id="etf-container">
                    <!-- Cards Populated by JS -->
                </div>
            </div>

            <!-- MAIN COLUMNS -->
            <div class="row g-4">
                <!-- Left: Data & News -->
                <div class="col-lg-8">
                    <!-- Indices Strip (Real API) -->
                    <div class="panel p-3 mb-4">
                        <h6 class="small text-secondary fw-bold mb-2 px-2">Câmbio & Cripto (AwesomeAPI & CoinGecko)</h6>
                        <div class="d-flex justify-content-between align-items-center overflow-auto gap-4" id="indices-strip">
                            <div class="text-secondary small">Carregando API...</div>
                        </div>
                    </div>

                    <!-- Latest News -->
                    <div class="panel">
                        <div class="panel-header">
                            <h6 class="panel-title">Feed de Notícias</h6>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-secondary active" onclick="app.filterNews('all')">Global</button>
                                <button class="btn btn-outline-secondary" onclick="app.filterNews('br')">Brasil</button>
                            </div>
                        </div>
                        <div id="home-news-list"></div>
                    </div>
                </div>

                <!-- Right: Movers & Heatmap -->
                <div class="col-lg-4">
                    <div class="panel">
                        <div class="panel-header"><h6 class="panel-title">Maiores Altas</h6></div>
                        <table class="table table-movers mb-0" id="table-gainers"></table>
                    </div>
                    
                    <div class="panel">
                        <div class="panel-header"><h6 class="panel-title">S&P 500 Heatmap</h6></div>
                        <div class="d-flex flex-wrap gap-1" style="height: 250px; align-content: flex-start;" id="heatmap-container"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ================= PAGE: AÇÕES (DETAILS) ================= -->
    <section id="acoes" class="view-section">
        <div class="container px-4">
            <div class="panel p-4">
                <div class="d-flex justify-content-between align-items-start mb-4">
                    <div>
                        <h1 class="fw-bold text-white mb-0" id="acoes-ticker-name">--</h1>
                        <div class="text-secondary font-mono small mb-2" id="acoes-exchange">--</div>
                        <div class="d-flex align-items-baseline gap-3">
                            <span class="display-4 fw-bold text-white font-mono" id="acoes-price">--</span>
                            <span class="fs-5 fw-bold font-mono" id="acoes-change-pct">--</span>
                        </div>
                    </div>
                    <div class="text-end">
                        <div class="badge bg-dark border border-secondary p-2 mb-2">
                            <div class="small text-secondary">RSI (14)</div>
                            <div class="fw-bold" id="acoes-rsi">--</div>
                        </div>
                    </div>
                </div>
                
                <div id="acoes-main-chart" style="min-height: 400px;"></div>

                <div class="row mt-4">
                    <div class="col-md-6">
                        <h6 class="text-secondary fw-bold mb-3">Fundamentos</h6>
                        <table class="table table-movers">
                            <tbody>
                                <tr><td>Setor</td><td class="text-end text-white" id="acoes-sector">--</td></tr>
                                <tr><td>P/L (P/E)</td><td class="text-end text-white font-mono" id="acoes-pe">--</td></tr>
                                <tr><td>Yield</td><td class="text-end text-white font-mono" id="acoes-yield">--</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-secondary fw-bold mb-3">Perfil</h6>
                        <p class="small text-secondary" id="acoes-profile">--</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ================= PAGE: NOTICIAS ================= -->
    <section id="noticias" class="view-section">
        <div class="container px-4">
            <h2 class="fw-bold mb-4">Últimas Notícias</h2>
            <div id="full-news-feed" class="row g-4"></div>
        </div>
    </section>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const cssColors = { green: '#00c076', red: '#ff3b30', blue: '#3b82f6', text: '#9ca3af', bg: '#0b0e11' };

        /**
         * SIMULATION ENGINE & API INTEGRATION
         */
        class MarketDataService {
            constructor() {
                // Base Simulada de Ações e ETFs (Alta Fidelidade)
                this.assets = [
                    // Tech & Mega Caps
                    { s: 'NVDA', n: 'NVIDIA Corp', p: 880.00, type: 'stock', sec: 'Tech' },
                    { s: 'AAPL', n: 'Apple Inc.', p: 175.50, type: 'stock', sec: 'Tech' },
                    { s: 'MSFT', n: 'Microsoft Corp', p: 420.00, type: 'stock', sec: 'Tech' },
                    { s: 'AMZN', n: 'Amazon.com', p: 180.00, type: 'stock', sec: 'Consumo' },
                    { s: 'GOOGL', n: 'Alphabet Inc.', p: 155.00, type: 'stock', sec: 'Tech' },
                    { s: 'TSLA', n: 'Tesla Inc', p: 170.00, type: 'stock', sec: 'Auto' },
                    // ETFs (NEW SECTION)
                    { s: 'IVV', n: 'iShares Core S&P 500', p: 525.00, type: 'etf', sec: 'Index' },
                    { s: 'QQQ', n: 'Invesco QQQ Trust', p: 445.00, type: 'etf', sec: 'Tech' },
                    { s: 'SMH', n: 'VanEck Semi ETF', p: 225.00, type: 'etf', sec: 'Semicon' },
                    { s: 'EWZ', n: 'iShares MSCI Brazil', p: 32.50, type: 'etf', sec: 'Emerging' },
                    { s: 'XLE', n: 'Energy Select Sector', p: 95.00, type: 'etf', sec: 'Energy' },
                    { s: 'GLD', n: 'SPDR Gold Shares', p: 215.00, type: 'etf', sec: 'Commodity' },
                    // BR Stocks
                    { s: 'PETR4', n: 'Petrobras PN', p: 39.00, type: 'stock', sec: 'Energy' },
                    { s: 'VALE3', n: 'Vale ON', p: 61.50, type: 'stock', sec: 'Mining' },
                    { s: 'ITUB4', n: 'Itaú Unibanco', p: 33.80, type: 'stock', sec: 'Finance' }
                ];
                
                // Adicionar volatilidade inicial simulada
                this.assets.forEach(a => {
                    a.change = (Math.random() * 4 - 2); // -2% a +2%
                    a.price = a.p * (1 + a.change/100);
                });
                
                this.realDataCache = null;
            }

            // API: AwesomeAPI (Câmbio Real)
            async fetchRealRates() {
                try {
                    const res = await fetch('https://economia.awesomeapi.com.br/last/USD-BRL,EUR-BRL,BTC-BRL');
                    const data = await res.json();
                    return [
                        { n: 'USD/BRL', v: data.USDBRL.bid, c: parseFloat(data.USDBRL.pctChange) },
                        { n: 'EUR/BRL', v: data.EURBRL.bid, c: parseFloat(data.EURBRL.pctChange) },
                        { n: 'BTC/BRL', v: parseFloat(data.BTCBRL.bid).toLocaleString('pt-BR'), c: parseFloat(data.BTCBRL.pctChange) }
                    ];
                } catch(e) { console.error(e); return []; }
            }

            // API: CoinGecko (Crypto Real)
            async fetchRealCrypto() {
                try {
                    const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana&vs_currencies=usd&include_24hr_change=true');
                    const data = await res.json();
                    return [
                        { n: 'BTC/USD', v: data.bitcoin.usd.toLocaleString(), c: data.bitcoin.usd_24h_change },
                        { n: 'ETH/USD', v: data.ethereum.usd.toLocaleString(), c: data.ethereum.usd_24h_change }
                    ];
                } catch(e) { console.error(e); return []; }
            }

            // Generate Simulated Hero Content (API Response Structure)
            async getHeroContent() {
                // Simula resposta de uma CMS/News API
                return {
                    main: {
                        title: "S&P 500 e Nasdaq atingem novas máximas com impulso de IA e Dados de Inflação",
                        img: "https://images.unsplash.com/photo-1611974765270-ca1258634369?q=80&w=1200",
                        ticker: 'SPY',
                        change: 1.25
                    },
                    side: [
                        { title: "Nvidia supera expectativas e arrasta setor de semicondutores.", img: "https://images.unsplash.com/photo-1624996379697-f01d168b1a52?q=80&w=200", ticker: 'NVDA', change: 3.4 },
                        { title: "Petrobras anuncia dividendos extraordinários após balanço.", img: "https://images.unsplash.com/photo-1565514020176-87219f646e00?q=80&w=200", ticker: 'PETR4', change: 2.1 },
                        { title: "Bitcoin rompe resistência dos $70k com fluxo de ETFs.", img: "https://images.unsplash.com/photo-1621416894569-0f39ed31d247?q=80&w=200", ticker: 'BTC', change: 4.5 },
                        { title: "Tesla corta preços na China para recuperar market share.", img: "https://images.unsplash.com/photo-1560958089-b8a1929cea89?q=80&w=200", ticker: 'TSLA', change: -1.8 },
                        { title: "Minério de ferro cai em Dalian afetando Vale (VALE3).", img: "https://images.unsplash.com/photo-1518182383220-72973059a058?q=80&w=200", ticker: 'VALE3', change: -0.9 }
                    ]
                };
            }

            getETFData() {
                return this.assets.filter(a => a.type === 'etf').map(e => {
                    // Add chart mock data
                    e.chartData = Array.from({length: 10}, () => Math.random() * 10 + e.p);
                    return e;
                });
            }
            
            getMovers() {
                const sorted = [...this.assets].sort((a,b) => b.change - a.change);
                return sorted.slice(0, 5);
            }

            getAssetDetails(ticker) {
                return this.assets.find(a => a.s === ticker) || {s:ticker, n:'Unknown', p:0, change:0};
            }
        }

        const service = new MarketDataService();

        /**
         * APP CONTROLLER
         */
        const app = {
            init: async () => {
                app.router('home');
                await app.loadDashboard();
                app.setupSearch();
                app.startTickerTape();
            },

            router: (page) => {
                document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
                document.getElementById(page).classList.add('active');
                document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
                document.querySelector(`[data-target="${page}"]`)?.classList.add('active');
                window.scrollTo(0,0);
            },

            loadDashboard: async () => {
                document.getElementById('market-status').innerText = "ATUALIZANDO...";
                document.getElementById('status-dot').className = "fas fa-circle text-warning me-2";

                // 1. Load Real API Data (Indices)
                const [rates, crypto] = await Promise.all([service.fetchRealRates(), service.fetchRealCrypto()]);
                const indices = [...rates, ...crypto];
                
                document.getElementById('indices-strip').innerHTML = indices.map(i => `
                    <div class="d-flex flex-column align-items-center" style="min-width: 100px;">
                        <span class="text-secondary small fw-bold">${i.n}</span>
                        <span class="font-mono fw-bold text-white">${i.v}</span>
                        <span class="small ${i.c >= 0 ? 'text-green' : 'text-red'}">${i.c >= 0 ? '+' : ''}${i.c.toFixed(2)}%</span>
                    </div>
                `).join('<div class="border-end border-secondary h-75 mx-2"></div>');

                document.getElementById('market-status').innerText = "MERCADO ONLINE";
                document.getElementById('status-dot').className = "fas fa-circle text-success me-2";

                // 2. Load Hero Section (New Layout)
                const heroContent = await service.getHeroContent();
                
                // Main Hero Render
                const heroMain = document.querySelector('.hero-main');
                heroMain.style.backgroundImage = `url('${heroContent.main.img}')`;
                heroMain.onclick = () => app.loadNews(0);
                heroMain.innerHTML = `
                    <div class="hero-main-content">
                        <div class="badge bg-danger mb-2">MANCHETE GLOBAL</div>
                        <h2 class="display-6 fw-bold text-white mb-3" style="text-shadow: 0 2px 10px rgba(0,0,0,0.8);">${heroContent.main.title}</h2>
                        <div class="d-flex align-items-center">
                            <div class="bg-dark bg-opacity-75 border border-secondary rounded px-3 py-2 d-flex align-items-center gap-3 backdrop-blur">
                                <span class="fw-bold text-accent-blue">${heroContent.main.ticker}</span>
                                <span class="font-mono ${heroContent.main.change >= 0 ? 'text-green' : 'text-red'} fw-bold">
                                    ${heroContent.main.change >= 0 ? '<i class="fas fa-caret-up"></i>' : '<i class="fas fa-caret-down"></i>'} 
                                    ${Math.abs(heroContent.main.change)}%
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                // Hero List Render
                const heroList = document.querySelector('.hero-list');
                heroList.innerHTML = heroContent.side.map((item, index) => `
                    <div class="hero-thumb-item" onclick="app.loadTicker('${item.ticker}')">
                        <img src="${item.img}" class="thumb-img" alt="${item.ticker}">
                        <div class="thumb-content">
                            <div class="thumb-title">${item.title}</div>
                            <div class="thumb-ticker-badge">
                                <span class="val">${item.ticker}</span>
                                <span class="${item.change >= 0 ? 'text-green' : 'text-red'}">
                                    ${item.change >= 0 ? '+' : ''}${item.change}%
                                </span>
                            </div>
                        </div>
                    </div>
                `).join('');

                // 3. Load ETF Section
                const etfs = service.getETFData();
                const etfContainer = document.getElementById('etf-container');
                etfContainer.innerHTML = etfs.map(etf => {
                    const isUp = etf.change >= 0;
                    // Mock Sparkline SVG
                    const points = etf.chartData.map((p, i) => `${i * 22},${30 - (p - etf.p + 5) * 2}`).join(' ');
                    return `
                    <div class="etf-card" onclick="app.loadTicker('${etf.s}')">
                        <div class="etf-header">
                            <div>
                                <div class="etf-symbol">${etf.s}</div>
                                <span class="etf-name">${etf.n}</span>
                            </div>
                            <span class="badge ${isUp ? 'bg-green-subtle' : 'bg-red-subtle'}">${isUp?'+':''}${etf.change.toFixed(2)}%</span>
                        </div>
                        <div class="etf-price">$${etf.price.toFixed(2)}</div>
                        <svg class="etf-chart" viewBox="0 0 200 40">
                            <polyline fill="none" stroke="${isUp ? cssColors.green : cssColors.red}" stroke-width="2" points="${points}" />
                        </svg>
                    </div>`;
                }).join('');

                // 4. Movers
                const movers = service.getMovers();
                document.getElementById('table-gainers').innerHTML = movers.map(m => `
                    <tr onclick="app.loadTicker('${m.s}')" style="cursor:pointer;">
                        <td><span class="fw-bold text-white">${m.s}</span></td>
                        <td class="text-end font-mono text-white">${m.price.toFixed(2)}</td>
                        <td class="text-end font-mono ${m.change>=0?'text-green':'text-red'}">${m.change.toFixed(2)}%</td>
                    </tr>
                `).join('');

                // 5. Heatmap (Simulated)
                const hm = document.getElementById('heatmap-container');
                hm.innerHTML = service.assets.map(a => {
                    const w = Math.max(40, Math.random() * 100);
                    const h = Math.max(40, Math.random() * 80);
                    const op = 0.2 + (Math.abs(a.change)/5); // Opacity based on magnitude
                    const color = a.change >= 0 ? `rgba(0, 192, 118, ${op})` : `rgba(255, 59, 48, ${op})`;
                    return `<div onclick="app.loadTicker('${a.s}')" style="flex-grow:1; min-width:${w}px; height:${h}px; background:${color}; display:grid; place-items:center; font-size:0.7rem; font-weight:bold; color:white; cursor:pointer;">${a.s}<br>${a.change.toFixed(1)}%</div>`;
                }).join('');
                
                // 6. News List
                app.filterNews('all');
            },

            loadTicker: (ticker) => {
                app.router('acoes');
                const asset = service.getAssetDetails(ticker);
                document.getElementById('acoes-ticker-name').innerText = `${asset.s} - ${asset.n}`;
                document.getElementById('acoes-exchange').innerText = `${asset.type === 'etf' ? 'ETF GLOBAL' : 'AÇÃO'} • Setor: ${asset.sec}`;
                document.getElementById('acoes-price').innerText = asset.price.toFixed(2);
                
                const color = asset.change >= 0 ? 'text-green' : 'text-red';
                document.getElementById('acoes-change-pct').innerText = `${asset.change>=0?'+':''}${asset.change.toFixed(2)}%`;
                document.getElementById('acoes-change-pct').className = `fs-5 fw-bold font-mono ${color}`;

                // Stats
                document.getElementById('acoes-sector').innerText = asset.sec;
                document.getElementById('acoes-pe').innerText = (Math.random()*30+10).toFixed(1) + 'x';
                document.getElementById('acoes-yield').innerText = (Math.random()*5).toFixed(2) + '%';
                document.getElementById('acoes-rsi').innerText = Math.floor(Math.random()*60+20);
                document.getElementById('acoes-profile').innerText = `Descrição detalhada gerada automaticamente para ${asset.n}. Este ativo é negociado nos principais mercados e apresenta alta liquidez.`;

                // Chart
                const data = Array.from({length: 30}, (_,i) => [Date.now()-i*86400000, asset.price * (1 + Math.sin(i)*0.05)]);
                new ApexCharts(document.querySelector("#acoes-main-chart"), {
                    series: [{name: ticker, data: data}],
                    chart: {type:'area', height:400, background:'transparent', toolbar:{show:false}},
                    theme: {mode:'dark'},
                    stroke: {curve:'smooth', width:2, colors:[cssColors.blue]},
                    fill: {type:'gradient', gradient:{opacityFrom:0.5, opacityTo:0.1}},
                    xaxis: {type:'datetime', labels:{style:{colors:cssColors.text}}},
                    yaxis: {labels:{style:{colors:cssColors.text}, formatter:(v)=>v.toFixed(2)}},
                    grid: {borderColor:'#333'}
                }).render();
            },

            startTickerTape: () => {
                const el = document.getElementById('ticker-content');
                // Build content
                const items = service.assets.map(a => `<div class="ticker-item"><span class="fw-bold text-white">${a.s}</span> <span class="${a.change>=0?'text-green':'text-red'}">${a.price.toFixed(2)} (${a.change.toFixed(2)}%)</span></div>`);
                el.innerHTML = items.join('') + items.join(''); // Double for loop
                gsap.to("#ticker-content", {x: "-50%", duration: 40, ease: "none", repeat: -1});
            },

            setupSearch: () => {
                const inp = document.getElementById('global-search');
                const list = document.getElementById('search-results');
                inp.addEventListener('input', (e) => {
                    const val = e.target.value.toUpperCase();
                    if(!val) { list.classList.remove('active'); return; }
                    const match = service.assets.filter(a => a.s.startsWith(val));
                    list.innerHTML = match.map(a => `<li class="autocomplete-item" onclick="app.loadTicker('${a.s}'); document.getElementById('search-results').classList.remove('active');"><span><b>${a.s}</b> ${a.n}</span> <span class="badge bg-dark border border-secondary">${a.type.toUpperCase()}</span></li>`).join('');
                    list.classList.add('active');
                });
                document.addEventListener('click', (e) => { if(e.target !== inp) list.classList.remove('active'); });
            },
            
            filterNews: (cat) => {
                // Simulação de feed de noticias
                const news = [
                    {t: 'Banco Central sinaliza cortes na taxa Selic para próximo mês.', time: '10m'},
                    {t: 'Tech Stocks: Nvidia e AMD impulsionam Nasdaq a nova máxima.', time: '32m'},
                    {t: 'Petróleo sobe com tensões geopolíticas no Oriente Médio.', time: '1h'},
                    {t: 'China anuncia pacote de estímulos para setor imobiliário.', time: '2h'}
                ];
                document.getElementById('home-news-list').innerHTML = news.map(n => `
                    <div class="d-flex gap-3 mb-3 border-bottom border-secondary border-opacity-25 pb-3">
                        <div class="text-center" style="width: 50px;">
                            <div class="small text-secondary">${n.time}</div>
                            <i class="fas fa-newspaper text-accent-blue mt-1"></i>
                        </div>
                        <div>
                            <h6 class="text-white mb-1" style="font-size: 0.9rem; cursor: pointer;" onclick="app.router('noticias')">${n.t}</h6>
                            <span class="ticker-tag">MERCADO</span>
                        </div>
                    </div>
                `).join('');
            }
        };

        document.addEventListener('DOMContentLoaded', app.init);
    </script>
</body>
</html>
