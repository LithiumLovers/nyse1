<!DOCTYPE html>
<html lang="pt-br" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InvestNYSE Pro | Terminal Global EUA</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- ApexCharts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        :root {
            /* Core Dark Palette */
            --bg-dark: #0b0e11;      /* Fundo Principal (Deep Black) */
            --bg-panel: #161b22;     /* Paineis (Dark Blue/Grey) */
            --bg-hover: #1f2937;     /* Hover States */
            
            --text-primary: #e6edf3; /* Texto Principal (Off-white) */
            --text-secondary: #8b949e; /* Texto Secundário (Muted) */
            
            --border-color: #30363d; /* Bordas Sutis */
            
            /* Accents */
            --up-green: #238636;     /* GitHub Green Style */
            --up-green-text: #3fb950;
            --down-red: #da3633;     /* Professional Red */
            --down-red-text: #f85149;
            --accent-blue: #2f81f7;
            --accent-gold: #d29922;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Overrides for Bootstrap to ensure no white backgrounds */
        .card, .list-group-item, .modal-content {
            background-color: var(--bg-panel);
            border-color: var(--border-color);
            color: var(--text-primary);
        }

        /* Utilities */
        .font-mono { font-family: 'JetBrains Mono', monospace; letter-spacing: -0.5px; }
        
        .text-green { color: var(--up-green-text) !important; }
        .text-red { color: var(--down-red-text) !important; }
        
        /* Subtle backgrounds for badges */
        .bg-green-subtle { background: rgba(35, 134, 54, 0.2); color: var(--up-green-text); border: 1px solid rgba(35, 134, 54, 0.3); }
        .bg-red-subtle { background: rgba(218, 54, 51, 0.2); color: var(--down-red-text); border: 1px solid rgba(218, 54, 51, 0.3); }
        
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: #30363d; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #484f58; }

        /* Navbar */
        .navbar {
            background-color: rgba(11, 14, 17, 0.85);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-color);
            padding: 0.75rem 0;
            z-index: 1000;
        }
        .navbar-brand { font-weight: 800; letter-spacing: -0.5px; color: #fff !important; }
        .navbar-brand span { color: var(--accent-blue); }
        .nav-link { color: var(--text-secondary) !important; font-size: 0.85rem; font-weight: 600; text-transform: uppercase; cursor: pointer; transition: color 0.2s; }
        .nav-link:hover, .nav-link.active { color: var(--accent-blue) !important; }

        /* Search */
        .search-container { position: relative; width: 300px; }
        .search-input { 
            background-color: #0d1117; 
            border: 1px solid var(--border-color); 
            color: var(--text-primary); 
            font-size: 0.85rem; 
        }
        .search-input:focus { 
            background-color: #0d1117; 
            border-color: var(--accent-blue); 
            color: #fff; 
            box-shadow: 0 0 0 2px rgba(47, 129, 247, 0.2); 
        }
        
        .autocomplete-list {
            position: absolute; top: 100%; left: 0; right: 0; 
            background: var(--bg-panel); 
            border: 1px solid var(--border-color);
            z-index: 9999; list-style: none; padding: 0; margin: 0; 
            max-height: 300px; overflow-y: auto; display: none;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        .autocomplete-list.active { display: block; }
        .autocomplete-item { 
            padding: 10px 15px; cursor: pointer; 
            border-bottom: 1px solid var(--border-color); 
            display: flex; justify-content: space-between; 
        }
        .autocomplete-item:hover { background: var(--bg-hover); }

        /* Ticker Tape */
        .ticker-wrap { 
            position: fixed; top: 68px; width: 100%; 
            background: var(--bg-panel); 
            border-bottom: 1px solid var(--border-color); 
            height: 32px; line-height: 32px; z-index: 999; 
            overflow: hidden; 
        }
        .ticker-move { display: inline-block; white-space: nowrap; padding-right: 50px; }
        .ticker-item { display: inline-block; padding: 0 1.5rem; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; border-right: 1px solid var(--border-color); color: var(--text-secondary); }

        /* View Sections */
        .view-section { display: none; padding-top: 115px; min-height: 100vh; animation: fadeIn 0.4s ease; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Panels */
        .panel { 
            background: var(--bg-panel); 
            border: 1px solid var(--border-color); 
            border-radius: 6px; 
            padding: 1.25rem; 
            margin-bottom: 1.25rem; 
            position: relative; 
        }
        .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; border-bottom: 1px solid var(--border-color); padding-bottom: 0.8rem; }
        .panel-title { font-size: 0.9rem; font-weight: 700; color: var(--text-primary); text-transform: uppercase; letter-spacing: 0.5px; margin: 0; }

        /* ================== HERO SECTION ================== */
        .hero-container {
            display: grid;
            grid-template-columns: 2.5fr 1fr;
            gap: 1rem;
            height: 500px;
            margin-bottom: 2rem;
        }

        .hero-main {
            position: relative;
            border-radius: 6px;
            overflow: hidden;
            background-size: cover;
            background-position: center;
            cursor: pointer;
            display: flex;
            align-items: flex-end;
            border: 1px solid var(--border-color);
        }
        .hero-main::before {
            content: ''; position: absolute; top:0; left:0; width:100%; height:100%;
            background: linear-gradient(to top, rgba(11,14,17,0.95) 0%, rgba(11,14,17,0.4) 50%, rgba(11,14,17,0) 100%);
        }
        .hero-main-content { position: relative; z-index: 2; padding: 2.5rem; width: 100%; }
        
        .hero-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            height: 100%;
            overflow-y: auto;
        }
        
        .hero-thumb-item {
            display: flex;
            align-items: center;
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
            min-height: 85px;
        }
        .hero-thumb-item:hover { 
            background: var(--bg-hover); 
            border-color: var(--text-secondary); 
        }
        
        .thumb-img {
            width: 80px; height: 60px;
            border-radius: 4px;
            object-fit: cover;
            margin-right: 12px;
            flex-shrink: 0;
            border: 1px solid var(--border-color);
        }
        
        .thumb-content { flex-grow: 1; overflow: hidden; }
        .thumb-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
            line-height: 1.3;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
        }
        
        .thumb-ticker-badge {
            display: inline-flex;
            align-items: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 3px;
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border-color);
        }
        .thumb-ticker-badge .val { color: var(--text-primary); margin-right: 5px; font-weight: bold; }
        
        /* ================== ETF SCROLL ================== */
        .etf-scroll-container {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding-bottom: 10px;
            margin-bottom: 1.5rem;
        }
        
        .etf-card {
            min-width: 220px;
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1rem;
            transition: transform 0.2s;
            cursor: pointer;
        }
        .etf-card:hover { transform: translateY(-3px); border-color: var(--accent-blue); }
        
        .etf-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .etf-symbol { font-weight: 800; font-size: 1.1rem; color: var(--text-primary); }
        .etf-name { font-size: 0.75rem; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; display: block;}
        .etf-price { font-family: 'JetBrains Mono', monospace; font-size: 1.2rem; font-weight: 700; color: var(--text-primary); }
        .etf-chart { height: 40px; width: 100%; margin-top: 8px; }

        /* Tables */
        .table { --bs-table-bg: transparent; --bs-table-color: var(--text-primary); }
        .table-movers th { 
            font-size: 0.7rem; 
            color: var(--text-secondary); 
            border-bottom: 1px solid var(--border-color); 
            font-weight: 600; 
            text-transform: uppercase; 
        }
        .table-movers td { 
            font-size: 0.85rem; 
            color: var(--text-primary); 
            border-bottom: 1px solid var(--border-color); 
            vertical-align: middle; 
            padding: 10px 8px; 
        }
        .table-hover tbody tr:hover { 
            background-color: var(--bg-hover); 
            color: var(--text-primary);
        }
        .table-movers tr:last-child td { border-bottom: none; }

        .ticker-tag { 
            font-size: 0.7rem; font-weight: 700; 
            color: var(--accent-blue); 
            background: rgba(47, 129, 247, 0.1); 
            padding: 1px 6px; border-radius: 3px; cursor: pointer; 
            border: 1px solid rgba(47, 129, 247, 0.2);
        }
        
        .shine-loader { background: linear-gradient(110deg, #161b22 8%, #1f2937 18%, #161b22 33%); background-size: 200% 100%; animation: 1.5s shine linear infinite; }
        @keyframes shine { to { background-position-x: -200%; } }

        /* Calendar/Events specific */
        .event-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }
        .event-item:last-child { border-bottom: none; }
        .event-time { font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: var(--text-secondary); min-width: 50px; }
        .event-title { font-size: 0.85rem; font-weight: 600; color: var(--text-primary); }
        .event-meta { display: flex; gap: 10px; font-size: 0.75rem; color: var(--text-secondary); }
        .impact-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .impact-high { background-color: var(--down-red); box-shadow: 0 0 5px rgba(218, 54, 51, 0.5); }
        .impact-med { background-color: var(--accent-gold); }
        .impact-low { background-color: var(--accent-blue); }

        /* Calc Styles */
        .form-row-calc { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
        .form-row-calc label { width: 50%; font-size: 0.9rem; color: var(--text-secondary); }
        .form-row-calc .input-group-calc { width: 45%; display: flex; align-items: center; gap: 5px; }
        
        /* Footer */
        footer {
            background-color: var(--bg-panel);
            border-top: 1px solid var(--border-color);
            padding: 3rem 0 1.5rem;
            margin-top: 4rem;
            font-size: 0.9rem;
        }
        .footer-brand { font-weight: 800; font-size: 1.5rem; color: #fff; letter-spacing: -0.5px; margin-bottom: 1rem; display: block; text-decoration: none; }
        .footer-brand span { color: var(--accent-blue); }
        .footer-text { color: var(--text-secondary); line-height: 1.6; margin-bottom: 1.5rem; font-size: 0.9rem; }
        .footer-heading { color: #fff; font-weight: 700; margin-bottom: 1.2rem; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 0.5px; }
        .footer-links { list-style: none; padding: 0; margin: 0; }
        .footer-links li { margin-bottom: 0.8rem; }
        .footer-links a { color: var(--text-secondary); text-decoration: none; transition: color 0.2s; }
        .footer-links a:hover { color: var(--accent-blue); }
        .footer-bottom { border-top: 1px solid var(--border-color); padding-top: 1.5rem; margin-top: 2rem; text-align: center; color: var(--text-secondary); font-size: 0.8rem; }

        @media(max-width: 992px) { 
            .hero-container { grid-template-columns: 1fr; height: auto; } 
            .hero-main { height: 300px; margin-bottom: 1rem; }
            .hero-list { height: auto; max-height: none; }
            .hero-thumb-item { margin-bottom: 0.5rem; }
        }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container-fluid px-4">
            <a class="navbar-brand" href="#" onclick="app.router('home')">INVEST<span>NYSE</span> PRO</a>
            <button class="navbar-toggler navbar-dark border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navContent">
                <ul class="navbar-nav me-auto ms-3">
                    <li class="nav-item"><a class="nav-link active" onclick="app.router('home')" data-target="home">Terminal</a></li>
                    <li class="nav-item"><a class="nav-link" onclick="app.router('acoes'); app.loadTicker('NVDA')" data-target="acoes">Ações</a></li>
                    <li class="nav-item"><a class="nav-link" onclick="app.router('dividendos')" data-target="dividendos">Dividendos</a></li>
                    <li class="nav-item"><a class="nav-link" onclick="app.router('reits'); app.loadTicker('O')" data-target="reits">REITs</a></li>
                    <li class="nav-item"><a class="nav-link" onclick="app.router('etfs'); app.loadTicker('SPY')" data-target="etfs">ETFs</a></li>
                </ul>
                <div class="d-flex align-items-center gap-3">
                    <div class="search-container">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text bg-dark border-secondary text-secondary"><i class="fas fa-search"></i></span>
                            <input type="text" class="form-control search-input" id="global-search" placeholder="Ticker (Ex: AAPL)..." autocomplete="off">
                        </div>
                        <ul class="autocomplete-list" id="search-results"></ul>
                    </div>
                    <div class="text-secondary small d-flex align-items-center">
                        <i class="fas fa-circle text-success me-2" style="font-size: 8px;" id="status-dot"></i>
                        <span id="market-status" style="font-size: 0.75rem; font-weight: 600;">CONECTANDO</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Ticker Tape -->
    <div class="ticker-wrap">
        <div class="ticker-move" id="ticker-content"></div>
    </div>

    <!-- ================= PAGE: HOME ================= -->
    <section id="home" class="view-section active">
        <div class="container-fluid px-4">
            
            <!-- HERO SECTION -->
            <div class="hero-container" id="hero-section">
                <div class="hero-main shine-loader"></div>
                <div class="hero-list">
                     <div class="hero-thumb-item shine-loader"></div>
                     <div class="hero-thumb-item shine-loader"></div>
                     <div class="hero-thumb-item shine-loader"></div>
                     <div class="hero-thumb-item shine-loader"></div>
                     <div class="hero-thumb-item shine-loader"></div>
                </div>
            </div>

            <!-- ETF SECTION -->
            <div class="mb-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="text-white fw-bold m-0"><i class="fas fa-layer-group me-2 text-accent-blue"></i>ETFs Globais em Destaque</h5>
                    <span class="badge bg-dark border border-secondary text-secondary">Mercado EUA</span>
                </div>
                <div class="etf-scroll-container" id="etf-container">
                    <div class="text-secondary small ms-2">Carregando dados...</div>
                </div>
            </div>

            <!-- 3 COLUMN DATA SECTION -->
            <div class="row g-4 mb-4">
                <div class="col-lg-4">
                    <div class="panel h-100">
                        <div class="panel-header"><h6 class="panel-title">Ações Mais Ativas</h6></div>
                        <table class="table table-movers mb-0 table-hover" id="table-active"></table>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="panel h-100">
                        <div class="panel-header"><h6 class="panel-title text-green">Maiores Altas (Top 10)</h6></div>
                        <table class="table table-movers mb-0 table-hover" id="table-gainers"></table>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="panel h-100">
                        <div class="panel-header"><h6 class="panel-title text-red">Maiores Baixas (Top 10)</h6></div>
                        <table class="table table-movers mb-0 table-hover" id="table-losers"></table>
                    </div>
                </div>
            </div>

            <!-- LOWER SECTION: Indices, Heatmap, Events -->
            <div class="row g-4">
                <!-- Left: Indices & News -->
                <div class="col-lg-4">
                    <div class="panel">
                        <div class="panel-header">
                            <h6 class="panel-title">Índices Principais EUA</h6>
                            <span class="badge bg-primary bg-opacity-25 border border-primary text-primary">EUA</span>
                        </div>
                        <table class="table table-movers mb-0" id="table-us-indices">
                            <!-- Populated by JS -->
                        </table>
                    </div>
                    
                    <div class="panel mt-4">
                        <div class="panel-header">
                            <h6 class="panel-title">Notícias Rápidas</h6>
                        </div>
                        <div id="home-news-list"></div>
                    </div>
                </div>

                <!-- Center: Heatmap (Resized) -->
                <div class="col-lg-4">
                    <div class="panel h-100">
                        <div class="panel-header"><h6 class="panel-title">S&P 500 Heatmap</h6></div>
                        <div class="d-flex flex-wrap gap-1" style="height: 400px; align-content: flex-start;" id="heatmap-container"></div>
                    </div>
                </div>

                <!-- Right: Important Events (New) -->
                <div class="col-lg-4">
                    <div class="panel h-100">
                        <div class="panel-header">
                            <h6 class="panel-title">Agenda Econômica</h6>
                            <span class="badge bg-warning bg-opacity-10 border border-warning text-warning">HOJE</span>
                        </div>
                        <div id="events-list" class="d-flex flex-column">
                            <!-- Populated by JS -->
                        </div>
                        <div class="text-center mt-3">
                            <button class="btn btn-sm btn-outline-secondary w-100">Ver Calendário Completo</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ================= PAGE: AÇÕES / REITS / ETFS (GENERIC DETAILS) ================= -->
    <section id="acoes" class="view-section">
        <div class="container px-4">
            <div class="panel p-4">
                <div class="d-flex justify-content-between align-items-start mb-4">
                    <div>
                        <h1 class="fw-bold text-white mb-0" id="acoes-ticker-name">--</h1>
                        <div class="text-secondary font-mono small mb-2" id="acoes-exchange">--</div>
                        <div class="d-flex align-items-baseline gap-3">
                            <span class="display-4 fw-bold text-white font-mono" id="acoes-price">--</span>
                            <span class="fs-5 fw-bold font-mono" id="acoes-change-pct">--</span>
                        </div>
                    </div>
                    <div class="text-end">
                        <div class="badge bg-dark border border-secondary p-2 mb-2">
                            <div class="small text-secondary">RSI (14)</div>
                            <div class="fw-bold" id="acoes-rsi">--</div>
                        </div>
                    </div>
                </div>
                
                <div id="acoes-main-chart" style="min-height: 400px;"></div>

                <div class="row mt-4">
                    <div class="col-md-6">
                        <h6 class="text-secondary fw-bold mb-3">Fundamentos</h6>
                        <table class="table table-movers">
                            <tbody>
                                <tr><td>Setor</td><td class="text-end text-white" id="acoes-sector">--</td></tr>
                                <tr><td>P/L (P/E)</td><td class="text-end text-white font-mono" id="acoes-pe">--</td></tr>
                                <tr><td>Yield</td><td class="text-end text-white font-mono" id="acoes-yield">--</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-secondary fw-bold mb-3">Perfil</h6>
                        <p class="small text-secondary" id="acoes-profile">--</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <section id="reits" class="view-section"><div class="container px-4 text-center mt-5"><h3 class="text-white">Visualização de REITs</h3><p class="text-secondary">Use a busca ou clique em um ticker para ver detalhes.</p></div></section>
    <section id="etfs" class="view-section"><div class="container px-4 text-center mt-5"><h3 class="text-white">Visualização de ETFs</h3><p class="text-secondary">Use a busca ou clique em um ticker para ver detalhes.</p></div></section>

    <!-- ================= PAGE: DIVIDENDOS ================= -->
    <section id="dividendos" class="view-section">
        <div class="container px-4">
            <div class="row g-4">
                <div class="col-lg-4">
                    <div class="panel h-100">
                        <h6 class="panel-title mb-3">Simulador DRIP</h6>
                        <form onsubmit="event.preventDefault(); app.runCalc();">
                            <div class="form-row-calc">
                                <label>Investimento ($):</label>
                                <div class="input-group-calc"><input type="number" class="form-control search-input text-end" id="calc-initial-investment" value="10000"></div>
                            </div>
                            <div class="form-row-calc">
                                <label>Preço Ação ($):</label>
                                <div class="input-group-calc"><input type="number" class="form-control search-input text-end" id="calc-share-price" value="150.00"></div>
                            </div>
                            <div class="form-row-calc">
                                <label>Dividendo/Ação:</label>
                                <div class="input-group-calc"><input type="number" class="form-control search-input text-end" id="calc-dividend-amount" value="3.50"></div>
                            </div>
                            <div class="form-row-calc">
                                <label>Anos:</label>
                                <div class="input-group-calc"><input type="number" class="form-control search-input text-end" id="calc-years-input" value="10"></div>
                            </div>
                            <button type="submit" class="btn btn-terminal w-100 py-2 mt-4">CALCULAR</button>
                        </form>
                        <div class="mt-4 text-center">
                            <div class="small text-secondary">Total Projetado</div>
                            <div class="fs-4 fw-bold text-green" id="calc-result">$ 0,00</div>
                        </div>
                        <div id="drip-chart" class="mt-3"></div>
                    </div>
                </div>
                <div class="col-lg-8 d-flex align-items-center justify-content-center text-secondary">
                    <div class="text-center">
                        <i class="fas fa-chart-pie fa-3x mb-3 opacity-25"></i>
                        <p>Selecione os parâmetros ao lado para projetar o crescimento dos dividendos (USD).</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const cssColors = { green: '#238636', red: '#da3633', blue: '#2f81f7', text: '#8b949e', bg: '#0b0e11' };

        /**
         * SIMULATION ENGINE & API INTEGRATION
         */
        class MarketDataService {
            constructor() {
                // Base Expandida de Ativos EUA
                this.assets = [
                    { s: 'NVDA', n: 'NVIDIA Corp', p: 880.00, type: 'stock', sec: 'Tech' },
                    { s: 'AAPL', n: 'Apple Inc.', p: 175.50, type: 'stock', sec: 'Tech' },
                    { s: 'MSFT', n: 'Microsoft Corp', p: 420.00, type: 'stock', sec: 'Tech' },
                    { s: 'AMZN', n: 'Amazon.com', p: 180.00, type: 'stock', sec: 'Consumo' },
                    { s: 'GOOGL', n: 'Alphabet Inc.', p: 155.00, type: 'stock', sec: 'Tech' },
                    { s: 'META', n: 'Meta Platforms', p: 490.00, type: 'stock', sec: 'Tech' },
                    { s: 'TSLA', n: 'Tesla Inc', p: 170.00, type: 'stock', sec: 'Auto' },
                    { s: 'AMD', n: 'Advanced Micro Devices', p: 170.00, type: 'stock', sec: 'Semicon' },
                    { s: 'NFLX', n: 'Netflix Inc', p: 610.00, type: 'stock', sec: 'Media' },
                    { s: 'INTC', n: 'Intel Corp', p: 42.00, type: 'stock', sec: 'Semicon' },
                    { s: 'JPM', n: 'JPMorgan Chase', p: 195.00, type: 'stock', sec: 'Finance' },
                    { s: 'V', n: 'Visa Inc.', p: 280.00, type: 'stock', sec: 'Finance' },
                    { s: 'KO', n: 'Coca-Cola Co', p: 60.00, type: 'stock', sec: 'Staples' },
                    { s: 'MCD', n: 'McDonald\'s', p: 270.00, type: 'stock', sec: 'Cyclical' },
                    { s: 'DIS', n: 'Disney', p: 115.00, type: 'stock', sec: 'Media' },
                    { s: 'XOM', n: 'Exxon Mobil', p: 118.00, type: 'stock', sec: 'Energy' },
                    { s: 'JNJ', n: 'Johnson & Johnson', p: 155.00, type: 'stock', sec: 'Health' },
                    { s: 'PFE', n: 'Pfizer Inc', p: 27.00, type: 'stock', sec: 'Health' },
                    { s: 'O', n: 'Realty Income', p: 52.00, type: 'reit', sec: 'Retail REIT' },
                    { s: 'AMT', n: 'American Tower', p: 190.00, type: 'reit', sec: 'Specialty' },
                    { s: 'PLD', n: 'Prologis Inc', p: 125.00, type: 'reit', sec: 'Industrial' },
                    { s: 'SPG', n: 'Simon Property', p: 150.00, type: 'reit', sec: 'Retail' },
                    { s: 'CCI', n: 'Crown Castle', p: 105.00, type: 'reit', sec: 'Specialty' },
                    { s: 'VICI', n: 'VICI Properties', p: 29.00, type: 'reit', sec: 'Hotel' },
                    { s: 'SPY', n: 'SPDR S&P 500', p: 520.00, type: 'etf', sec: 'Index' },
                    { s: 'QQQ', n: 'Invesco QQQ', p: 445.00, type: 'etf', sec: 'Tech' },
                    { s: 'IWM', n: 'Russell 2000 ETF', p: 205.00, type: 'etf', sec: 'Small Cap' },
                    { s: 'DIA', n: 'SPDR Dow Jones', p: 390.00, type: 'etf', sec: 'Large Cap' },
                    { s: 'SMH', n: 'VanEck Semi ETF', p: 225.00, type: 'etf', sec: 'Semicon' },
                    { s: 'XLE', n: 'Energy Select', p: 95.00, type: 'etf', sec: 'Energy' },
                    { s: 'GLD', n: 'SPDR Gold', p: 215.00, type: 'etf', sec: 'Commodity' },
                    { s: 'VNQ', n: 'Vanguard Real Estate', p: 84.00, type: 'etf', sec: 'REITs' }
                ];
                
                this.indicesEUA = [
                    { n: 'S&P 500', v: 5240.50, c: 0.85 },
                    { n: 'Nasdaq 100', v: 18300.10, c: 1.20 },
                    { n: 'Dow Jones', v: 39500.22, c: 0.40 },
                    { n: 'Russell 2000', v: 2080.50, c: -0.25 },
                    { n: 'VIX', v: 13.50, c: -2.10 }
                ];

                // Gerar variação aleatória para cada ativo
                this.assets.forEach(a => {
                    a.change = (Math.random() * 6 - 3); 
                    if (a.s === 'NVDA') a.change = 4.5;
                    if (a.s === 'TSLA') a.change = -2.1;
                    a.price = a.p * (1 + a.change/100);
                });
            }

            async fetchRealRates() {
                try {
                    const res = await fetch('https://economia.awesomeapi.com.br/last/USD-BRL,EUR-BRL,BTC-USD');
                    const data = await res.json();
                    return [
                        { n: 'USD/BRL', v: data.USDBRL.bid, c: parseFloat(data.USDBRL.pctChange) },
                        { n: 'EUR/BRL', v: data.EURBRL.bid, c: parseFloat(data.EURBRL.pctChange) }
                    ];
                } catch(e) { console.error(e); return []; }
            }
            async fetchRealCrypto() {
                try {
                    const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=usd&include_24hr_change=true');
                    const data = await res.json();
                    return [
                        { n: 'BTC/USD', v: data.bitcoin.usd.toLocaleString(), c: data.bitcoin.usd_24h_change },
                        { n: 'ETH/USD', v: data.ethereum.usd.toLocaleString(), c: data.ethereum.usd_24h_change }
                    ];
                } catch(e) { console.error(e); return []; }
            }

            getTopGainers(count = 10) { return [...this.assets].sort((a,b) => b.change - a.change).slice(0, count); }
            getTopLosers(count = 10) { return [...this.assets].sort((a,b) => a.change - b.change).slice(0, count); }
            getActiveStocks(count = 10) { 
                return [...this.assets].sort(() => 0.5 - Math.random()).slice(0, count); 
            }

            // Economic Events Simulation
            getEconomicEvents() {
                return [
                    { time: '10:00', event: 'Discurso do Fed Chair Powell', impact: 'high', actual: '', forecast: '' },
                    { time: '11:00', event: 'Vendas de Casas Novas', impact: 'med', actual: '680K', forecast: '675K' },
                    { time: '11:30', event: 'Estoques de Petróleo Bruto', impact: 'high', actual: '', forecast: '-1.2M' },
                    { time: '14:00', event: 'Leilão Treasury 5 Anos', impact: 'med', actual: '', forecast: '' },
                    { time: '16:30', event: 'API Weekly Crude Stock', impact: 'low', actual: '', forecast: '' }
                ];
            }

            async getHeroContent() {
                const rawNews = [
                    { title: "Nvidia lidera rali de IA com novos chips.", img: "https://images.unsplash.com/photo-1624996379697-f01d168b1a52?q=80&w=200", ticker: 'NVDA' },
                    { title: "Apple enfrenta desafios regulatórios na UE.", img: "https://images.unsplash.com/photo-1611186871348-b1ce696e52c9?q=80&w=200", ticker: 'AAPL' },
                    { title: "Amazon investe em data centers nucleares.", img: "https://images.unsplash.com/photo-1523474253046-8cd2748b5fd2?q=80&w=200", ticker: 'AMZN' },
                    { title: "Realty Income aumenta dividendos mensais.", img: "https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?q=80&w=200", ticker: 'O' },
                    { title: "Tesla ajusta produção em Xangai.", img: "https://images.unsplash.com/photo-1560958089-b8a1929cea89?q=80&w=200", ticker: 'TSLA' }
                ];

                const enriched = rawNews.map(n => {
                    const asset = this.assets.find(a => a.s === n.ticker);
                    return { ...n, change: asset ? asset.change : 0 };
                });

                enriched.sort((a,b) => b.change - a.change);

                return {
                    main: {
                        title: "Mercados EUA: S&P 500 busca máximas com força do setor tecnológico",
                        img: "https://images.unsplash.com/photo-1611974765270-ca1258634369?q=80&w=1200",
                        ticker: 'SPY',
                        change: 0.85
                    },
                    side: enriched
                };
            }

            getETFData() {
                return this.assets.filter(a => a.type === 'etf').map(e => {
                    e.chartData = Array.from({length: 10}, () => Math.random() * 10 + e.p);
                    return e;
                });
            }
            
            getAssetDetails(ticker) {
                return this.assets.find(a => a.s === ticker) || {s:ticker, n:'Unknown', p:0, change:0};
            }
        }

        const service = new MarketDataService();

        const app = {
            init: async () => {
                app.router('home');
                await app.loadDashboard();
                app.setupSearch();
                app.startTickerTape();
            },

            router: (page) => {
                document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
                const targetId = ['acoes','reits','etfs'].includes(page) ? 'acoes' : page;
                const el = document.getElementById(targetId);
                if(el) el.classList.add('active');
                
                document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
                document.querySelector(`[data-target="${page}"]`)?.classList.add('active');
                window.scrollTo(0,0);
            },

            loadDashboard: async () => {
                document.getElementById('market-status').innerText = "ATUALIZANDO...";
                
                const [rates, crypto] = await Promise.all([service.fetchRealRates(), service.fetchRealCrypto()]);
                
                document.getElementById('market-status').innerText = "MERCADO EUA ONLINE";
                document.getElementById('status-dot').className = "fas fa-circle text-success me-2";

                // Hero
                const heroContent = await service.getHeroContent();
                const heroMain = document.querySelector('.hero-main');
                heroMain.style.backgroundImage = `url('${heroContent.main.img}')`;
                heroMain.innerHTML = `
                    <div class="hero-main-content">
                        <div class="badge bg-danger mb-2 border border-danger">MANCHETE</div>
                        <h2 class="display-6 fw-bold text-white mb-3" style="text-shadow: 0 2px 10px rgba(0,0,0,0.8);">${heroContent.main.title}</h2>
                        <div class="d-flex align-items-center">
                            <div class="bg-dark bg-opacity-75 border border-secondary rounded px-3 py-2 d-flex align-items-center gap-3 backdrop-blur">
                                <span class="fw-bold text-blue">${heroContent.main.ticker}</span>
                                <span class="font-mono ${heroContent.main.change >= 0 ? 'text-green' : 'text-red'} fw-bold">
                                    ${heroContent.main.change >= 0 ? '+' : ''}${heroContent.main.change}%
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                const heroList = document.querySelector('.hero-list');
                heroList.innerHTML = heroContent.side.map(item => `
                    <div class="hero-thumb-item" onclick="app.loadTicker('${item.ticker}')">
                        <img src="${item.img}" class="thumb-img" alt="${item.ticker}">
                        <div class="thumb-content">
                            <div class="thumb-title">${item.title}</div>
                            <div class="thumb-ticker-badge">
                                <span class="val">${item.ticker}</span>
                                <span class="${item.change >= 0 ? 'text-green' : 'text-red'}">
                                    ${item.change >= 0 ? '+' : ''}${item.change.toFixed(2)}%
                                </span>
                            </div>
                        </div>
                    </div>
                `).join('');

                // ETF Section
                const etfs = service.getETFData();
                document.getElementById('etf-container').innerHTML = etfs.map(etf => {
                    const isUp = etf.change >= 0;
                    const points = etf.chartData.map((p, i) => `${i * 22},${30 - (p - etf.p + 5) * 2}`).join(' ');
                    return `
                    <div class="etf-card" onclick="app.loadTicker('${etf.s}')">
                        <div class="etf-header">
                            <div><div class="etf-symbol">${etf.s}</div><span class="etf-name">${etf.n}</span></div>
                            <span class="badge ${isUp ? 'bg-green-subtle' : 'bg-red-subtle'}">${isUp?'+':''}${etf.change.toFixed(2)}%</span>
                        </div>
                        <div class="etf-price">$${etf.price.toFixed(2)}</div>
                        <svg class="etf-chart" viewBox="0 0 200 40">
                            <polyline fill="none" stroke="${isUp ? cssColors.green : cssColors.red}" stroke-width="2" points="${points}" />
                        </svg>
                    </div>`;
                }).join('');

                // Tables
                const renderTable = (list, id) => {
                    document.getElementById(id).innerHTML = list.map(m => `
                        <tr onclick="app.loadTicker('${m.s}')" style="cursor:pointer;">
                            <td><span class="fw-bold text-white">${m.s}</span></td>
                            <td class="text-end font-mono text-white">${m.price.toFixed(2)}</td>
                            <td class="text-end font-mono ${m.change>=0?'text-green':'text-red'}">${m.change.toFixed(2)}%</td>
                        </tr>
                    `).join('');
                };
                renderTable(service.getActiveStocks(10), 'table-active');
                renderTable(service.getTopGainers(10), 'table-gainers');
                renderTable(service.getTopLosers(10), 'table-losers');

                // US Indices Table
                document.getElementById('table-us-indices').innerHTML = service.indicesEUA.map(i => `
                    <tr>
                        <td><span class="fw-bold text-white">${i.n}</span></td>
                        <td class="text-end font-mono text-white">${i.v.toLocaleString()}</td>
                        <td class="text-end font-mono ${i.c>=0?'text-green':'text-red'}">${i.c>=0?'+':''}${i.c.toFixed(2)}%</td>
                    </tr>
                `).join('');

                // Heatmap
                const hm = document.getElementById('heatmap-container');
                hm.innerHTML = service.assets.map(a => {
                    const w = Math.max(40, Math.random() * 100);
                    const h = Math.max(40, Math.random() * 80);
                    const op = 0.2 + (Math.abs(a.change)/5);
                    const color = a.change >= 0 ? `rgba(35, 134, 54, ${op})` : `rgba(218, 54, 51, ${op})`;
                    return `<div onclick="app.loadTicker('${a.s}')" style="flex-grow:1; min-width:${w}px; height:${h}px; background:${color}; display:grid; place-items:center; font-size:0.7rem; font-weight:bold; color:#e6edf3; cursor:pointer;">${a.s}<br>${a.change.toFixed(1)}%</div>`;
                }).join('');
                
                // Economic Events (New Section)
                const events = service.getEconomicEvents();
                document.getElementById('events-list').innerHTML = events.map(evt => `
                    <div class="event-item">
                        <div class="event-time">${evt.time}</div>
                        <div style="flex-grow:1; padding: 0 10px;">
                            <div class="event-title"><span class="impact-dot impact-${evt.impact}"></span>${evt.event}</div>
                            <div class="event-meta">
                                <span>Real: <span class="text-white">${evt.actual || '--'}</span></span>
                                <span>Prev: ${evt.forecast || '--'}</span>
                            </div>
                        </div>
                    </div>
                `).join('');

                app.filterNews('all');
            },

            loadTicker: (ticker) => {
                const asset = service.getAssetDetails(ticker);
                let route = 'acoes';
                if(asset.type === 'reit') route = 'reits';
                if(asset.type === 'etf') route = 'etfs';
                
                app.router(route); 
                
                const viewId = 'acoes'; 
                if(route !== 'acoes') {
                    document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
                    document.getElementById('acoes').classList.add('active');
                }

                document.getElementById('acoes-ticker-name').innerText = `${asset.s} - ${asset.n}`;
                document.getElementById('acoes-exchange').innerText = `${asset.type.toUpperCase()} • Setor: ${asset.sec}`;
                document.getElementById('acoes-price').innerText = asset.price.toFixed(2);
                
                const color = asset.change >= 0 ? 'text-green' : 'text-red';
                document.getElementById('acoes-change-pct').innerText = `${asset.change>=0?'+':''}${asset.change.toFixed(2)}%`;
                document.getElementById('acoes-change-pct').className = `fs-5 fw-bold font-mono ${color}`;

                document.getElementById('acoes-sector').innerText = asset.sec;
                document.getElementById('acoes-pe').innerText = (Math.random()*30+10).toFixed(1) + 'x';
                document.getElementById('acoes-yield').innerText = (Math.random()*5).toFixed(2) + '%';
                document.getElementById('acoes-rsi').innerText = Math.floor(Math.random()*60+20);
                document.getElementById('acoes-profile').innerText = `Ativo negociado no mercado americano. Dados simulados de alta fidelidade para demonstração.`;

                const data = Array.from({length: 30}, (_,i) => [Date.now()-i*86400000, asset.price * (1 + Math.sin(i)*0.05)]);
                document.getElementById('acoes-main-chart').innerHTML = "";
                new ApexCharts(document.querySelector("#acoes-main-chart"), {
                    series: [{name: ticker, data: data}],
                    chart: {type:'area', height:400, background:'transparent', toolbar:{show:false}},
                    theme: {mode:'dark'},
                    stroke: {curve:'smooth', width:2, colors:[cssColors.blue]},
                    fill: {type:'gradient', gradient:{opacityFrom:0.5, opacityTo:0.1}},
                    xaxis: {type:'datetime', labels:{style:{colors:cssColors.text}}},
                    yaxis: {labels:{style:{colors:cssColors.text}, formatter:(v)=>v.toFixed(2)}},
                    grid: {borderColor:'#30363d'}
                }).render();
            },

            startTickerTape: () => {
                const el = document.getElementById('ticker-content');
                const items = service.assets.map(a => `<div class="ticker-item"><span class="fw-bold text-white">${a.s}</span> <span class="${a.change>=0?'text-green':'text-red'}">${a.price.toFixed(2)} (${a.change.toFixed(2)}%)</span></div>`);
                el.innerHTML = items.join('') + items.join('');
                gsap.to("#ticker-content", {x: "-50%", duration: 60, ease: "none", repeat: -1});
            },

            setupSearch: () => {
                const inp = document.getElementById('global-search');
                const list = document.getElementById('search-results');
                inp.addEventListener('input', (e) => {
                    const val = e.target.value.toUpperCase();
                    if(!val) { list.classList.remove('active'); return; }
                    const match = service.assets.filter(a => a.s.startsWith(val));
                    list.innerHTML = match.map(a => `<li class="autocomplete-item" onclick="app.loadTicker('${a.s}'); document.getElementById('search-results').classList.remove('active');"><span><b>${a.s}</b> ${a.n}</span> <span class="badge bg-dark border border-secondary">${a.type.toUpperCase()}</span></li>`).join('');
                    list.classList.add('active');
                });
                document.addEventListener('click', (e) => { if(e.target !== inp) list.classList.remove('active'); });
            },
            
            filterNews: (cat) => {
                const news = [
                    {t: 'Fed mantém taxas inalteradas e prevê cortes para 2025.', time: '10m'},
                    {t: 'Resultados da Nvidia impulsionam setor de semicondutores.', time: '32m'},
                    {t: 'Preços ao consumidor nos EUA sobem acima do esperado.', time: '1h'},
                    {t: 'Setor de REITs reage a novas projeções de juros.', time: '2h'}
                ];
                document.getElementById('home-news-list').innerHTML = news.map(n => `
                    <div class="d-flex gap-3 mb-3 border-bottom border-secondary border-opacity-25 pb-3">
                        <div class="text-center" style="width: 50px;">
                            <div class="small text-secondary">${n.time}</div>
                            <i class="fas fa-newspaper text-accent-blue mt-1"></i>
                        </div>
                        <div>
                            <h6 class="text-white mb-1" style="font-size: 0.85rem; cursor: pointer;" onclick="app.router('noticias')">${n.t}</h6>
                        </div>
                    </div>
                `).join('');
            },

            runCalc: () => {
                const P0 = parseFloat(document.getElementById('calc-initial-investment').value);
                const P_Share = parseFloat(document.getElementById('calc-share-price').value);
                const Div = parseFloat(document.getElementById('calc-dividend-amount').value);
                const Years = parseInt(document.getElementById('calc-years-input').value);
                let shares = P0 / P_Share;
                let totalVal = 0;
                const chartData = [];
                
                for(let i=0; i<Years; i++) {
                    let annualDivs = shares * Div * 4; 
                    let newShares = annualDivs / P_Share;
                    shares += newShares;
                    totalVal = shares * P_Share;
                    chartData.push(totalVal);
                }
                
                document.getElementById('calc-result').innerText = totalVal.toLocaleString('en-US', {style:'currency', currency:'USD'});
                
                document.getElementById('drip-chart').innerHTML = "";
                new ApexCharts(document.querySelector("#drip-chart"), {
                    series: [{ name: 'Valor Patrimonial', data: chartData.map(v=>v.toFixed(2)) }],
                    chart: { type: 'bar', height: 200, background: 'transparent', toolbar: {show:false} },
                    theme: { mode: 'dark' },
                    colors: [cssColors.green],
                    xaxis: { categories: Array.from({length:Years}, (_,i)=> `Ano ${i+1}`) }
                }).render();
            }
        };

        document.addEventListener('DOMContentLoaded', app.init);
    </script>
</body>
</html>
